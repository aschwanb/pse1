<div class="wrapper">
  <% if !@cont_sobjs.nil? %>
      <% jump_targets_text = Array.new %>
      <% jump_targets_ids = Array.new %>
      <% @cont_sobjs.each do |sobj| %>
          <% crit_hashtags = "" %>
          <% sobj.get_criteria_hashtags.each { |crit| crit_hashtags += crit.text + ", " } %>
          <% jump_targets_text.append(crit_hashtags.slice(0, crit_hashtags.length-2)) %>
          <% jump_id = sobj.get_criteria_hashtags.first.text + "-" + sobj.get_criteria_hashtags.last.text %>
          <% jump_targets_ids.append(jump_id) %>
      <% end %>
      <% jump_targets = Hash[jump_targets_ids.zip jump_targets_text] %>
      <div class="flex-container" style="display: none">
        <h1 class="flex-item">Jump to</h1>
        <% jump_targets.each do |key, text| %>
          <div class="flex-item list">
            <ul>
              <%= link_to content_tag(:li, text), :anchor => "#"+key %>
            </ul>
          </div>
        <% end %>
      </div>
      <% @cont_sobjs.each do |sobj| %>
          <% if sobj.is_successful? %>
              <% authors = sobj.get_authors %>
              <% hashtags = sobj.get_hashtags %>
              <% terms = "" %>
              <% sobj.get_search_terms.each { |term| terms += term + ", " } %>
              <% terms = terms.slice(0, terms.length-2) %>
              <% crit_hashtags = "" %>
              <% sobj.get_criteria_hashtags.each { |crit| crit_hashtags += crit.text + ", " } %>
              <% crit_hashtags = crit_hashtags.slice(0, crit_hashtags.length-2) %>
              <% crit_authors = "" %>
              <% sobj.get_criteria_authors.each { |crit| crit_authors += crit.screen_name + ", " } %>
              <% crit_authors = crit_authors.slice(0, crit_authors.length-2) %>
              <% pages = sobj.get_webpages %>
              <% jump_id = sobj.get_criteria_hashtags.first.text + "-" + sobj.get_criteria_hashtags.last.text %>

              <div id="<%= jump_id %>" class="flex-container">

                <div class="flex-item list">

                  <div class="item-headline-container">
                    <h1 class="item-headline">
                      <%= crit_hashtags.blank? ? "Hashtags used by " : "Hashtags cooccurring with " %>
                      <span class="highlight">
                  <%= crit_hashtags.blank? ? crit_authors : crit_hashtags %></span>
                    </h1>
                  </div>

                  <ul>
                    <% hashtags.take(10).each do |hashtag| %>
                        <%= link_to content_tag(:li, hashtag.text), action: "db_search", controller: "index", q: hashtag.text %>
                    <% end %>
                  </ul>

                </div>

                <% unless crit_hashtags.blank? %>
                    <div class="flex-item list">
                      <div class="item-headline-container">
                        <h1 class="item-headline">Authors associated with
                          <span class="highlight"><%= crit_hashtags %></span></h1>
                      </div>
                      <ul>
                        <% authors.take(10).each do |author| %>
                            <%= link_to content_tag(:li, "@"+author.screen_name), action: "db_search", controller: "index", q: "@"+author.screen_name %>
                        <% end %>
                      </ul>
                    </div>
                <% end %>

                <div class="flex-item flex-item-link list">

                  <div class="item-headline-container">
                    <h1 class="item-headline">
                      <%= crit_hashtags.blank? ? "Links posted by " : "Links associated with " %>
                      <span class="highlight">
                <%= crit_hashtags.blank? ? crit_authors : crit_hashtags %></span>
                    </h1>

                  </div>
                  <ul>
                    <% pages.take(10).each do |page| %>
                        <%= link_to content_tag(:li, link_preview_content(page), class: "link-preview" ), page.get_url %>
                    <% end %>

                  </ul>

                </div>

              </div>
          <% else %>
              <% if !@sobj.is_valid? %>
                  <h1>Invalid search</h1>
              <% else %>
                  <h1>Nothing found about <%= crit_hashtags %></h1>
              <% end %>
          <% end %>
      <% end %>
<% else %>
  <h1>NIL</h1>
  <% end %>
</div>
